<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ CHV MRC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .loading { text-align: center; margin-top: 20px; color: #666; }
        /* ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏≠‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î */
        #resultTable { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <h2 class="mb-4">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CHV MRC EX-Godown</h2>
        
        <div class="row mb-3">
            <div class="col-md-6">
                <input type="text" id="searchInput" class="form-control" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏ä‡∏∑‡πà‡∏≠, ‡∏£‡∏´‡∏±‡∏™, ‡∏Ø‡∏•‡∏Ø)...">
            </div>
            <div class="col-md-6 text-end">
                <small id="statusText" class="text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</small>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover table-bordered" id="dataTable">
                <thead class="table-dark" id="tableHead">
                    </thead>
                <tbody id="tableBody">
                    </tbody>
            </table>
        </div>
        
        <div id="loader" class="loading">
            <div class="spinner-border text-primary" role="status"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet...</p>
        </div>
    </div>

    <script>
        // ----------------------------------------------------
        // üî¥ ‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì Copy ‡∏°‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzRSN-sAPGu7NT4_M2R7FxgZvqhH1URhxMRp_hsy2KLCFylWvPP_Tkliayqo9yc-yik/exec"; 
        // ----------------------------------------------------

        let allData = []; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        async function fetchData() {
            try {
                const response = await fetch(SCRIPT_URL);
                const data = await response.json();
                
                if (data.length > 0) {
                    // ‡πÅ‡∏¢‡∏Å‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (row 0) ‡∏Å‡∏±‡∏ö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (row 1 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ)
                    const headers = data[0];
                    allData = data.slice(1); 

                    renderTable(headers, allData);
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('resultTable').style.display = 'table';
                    document.getElementById('statusText').innerText = `‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${allData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                    
                    // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                    document.getElementById('searchInput').addEventListener('keyup', (e) => {
                        filterData(e.target.value, headers);
                    });
                }
            } catch (error) {
                document.getElementById('loader').innerHTML = `<span class="text-danger">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</span>`;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        function renderTable(headers, rows) {
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            if (thead.innerHTML === "") {
                let headerHTML = "<tr>";
                headers.forEach(h => headerHTML += `<th>${h}</th>`);
                headerHTML += "</tr>";
                thead.innerHTML = headerHTML;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            let bodyHTML = "";
            // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 100 ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö‡∏Ñ‡πâ‡∏≤‡∏á (‡∏Å‡∏£‡∏ì‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å)
            const displayRows = rows.slice(0, 100); 
            
            if(displayRows.length === 0) {
                bodyHTML = `<tr><td colspan="${headers.length}" class="text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
            } else {
                displayRows.forEach(row => {
                    bodyHTML += "<tr>";
                    row.forEach(cell => {
                        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ (Optional)
                        let cellData = cell;
                        if (typeof cell === 'string' && cell.includes('T') && cell.length > 20) {
                            cellData = new Date(cell).toLocaleDateString('th-TH');
                        }
                        bodyHTML += `<td>${cellData}</td>`;
                    });
                    bodyHTML += "</tr>";
                });
            }
            tbody.innerHTML = bodyHTML;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (Filter)
        function filterData(keyword, headers) {
            const lowerKeyword = keyword.toLowerCase();
            
            const filtered = allData.filter(row => {
                // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ô‡∏±‡πâ‡∏ô‡πÜ
                return row.some(cell => 
                    String(cell).toLowerCase().includes(lowerKeyword)
                );
            });

            renderTable(headers, filtered);
            document.getElementById('statusText').innerText = `‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏à‡∏≠ ${filtered.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        fetchData();
    </script>

</body>
</html>
